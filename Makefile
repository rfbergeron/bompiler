# Makefile, Author: Robert Bergeron, ID: rbergero

CLASS = cse110a-wm.f19
ASG = asg5
# Extremely picky compiler options
WARN = -Wall -Wextra -Werror -Wpedantic -Wshadow -Wold-style-cast
# full gcc exec command
CPP  = g++ -g -O0 -std=gnu++17
CPPWARN = ${CPP} ${WARN} -fdiagnostics-color=never
CPPYY = ${CPP} -Wno-sign-compare -Wno-register
DEPCPP = g++ -std=gnu++17 -MM ${WARN}
MKFILE = Makefile
DEPFILE = ${MKFILE}.dep
GMAKE = ${MAKE} --no-print-directory
# name of the compiled executable
EXECNAME = oc
# .cpp source files
CPPSRC = main.cpp auxlib.cpp string_set.cpp astree.cpp lyutils.cpp \
      symtable.cpp intlang.cpp
# .h header files
HEADERS = auxlib.h string_set.h astree.h lyutils.h symtable.h intlang.h
# .gch header somethings?
GCH = auxlib.h.gch string_set.h.gch lyutils.h.gch astree.h.gch \
      yyparse.h.gch symtable.h.gch intlang.h.gch
# .o object files
OBJECTS = main.o auxlib.o string_set.o yylex.o yyparse.o \
      lyutils.o astree.o symtable.o intlang.o
# files generated by ex. flex and bison
GENS = yylex.cpp yyparse.cpp
HEADERGENS = yyparse.h

all : ${DEPFILE} ${EXECNAME}

${EXECNAME} : ${OBJECTS}
	${CPP} -o oc ${OBJECTS}

yylex.o : yylex.cpp
	${CPPYY} -c $< ${HEADERS} ${HEADERGENS}

yyparse.o : yyparse.cpp
	${CPPYY} -c $< ${HEADERS} ${HEADERGENS}

%.o : %.cpp
	${CPP} -c $< ${HEADERS} ${HEADERGENS}

yylex.cpp : scanner.l
	flex --outfile=yylex.cpp scanner.l

yyparse.h yyparse.cpp : parser.y
	bison -Wall -Wno-other -v --defines=yyparse.h \
      --output=yyparse.cpp parser.y

rmtest :
	rm -f *.str *.tok *.ast *.sym *.oil *.err *.out *.log \
      *.lexyacctrace

clean :
	rm -f ${OBJECTS} ${GCH} ${DEPFILE} ${GENS} ${HEADERGENS} \
      yyparse.output

submit:
	submit ${CLASS} ${ASG} README ${MKFILE} ${CPPSRC} \
      ${HEADERS} scanner.l parser.y

ci :
	git add ${HEADERS} ${CPPSRC} ${MKFILE} scanner.l parser.y \
      README DESIGN.md

spotless : clean rmtest
	rm -f ${EXECNAME}

deps : ${CPPSRC} ${GENS}
	${DEPCPP} ${CPPSRC} ${GENS} ${MKFILE} >> ${DEPFILE}

${DEPFILE} :
	@ touch ${DEPFILE}
	${GMAKE} deps
