# Makefile, Author: Robert Bergeron

WARN = -Wall -Wextra -Werror -Wpedantic -Wshadow
# full gcc exec command
C = gcc -g -O0 -std=c11
CWARN = ${C} ${WARN} -fdiagnostics-color=never
CYY = ${C} -Wno-sign-compare -Wno-register
CDEP = gcc -std=c11 -MM ${WARN}
MKFILE = Makefile
DEPFILE = ${MKFILE}.dep
GMAKE = ${MAKE} --no-print-directory
# name of the compiled executable
EXECNAME = bompiler
# .c source files
SRC = map.c
# .h header files
HDR = map.h
# .o object files
OBJ = ${SRC:.c=.o}
# files generated by flex and bison
GENSRC = yylex.c yyparse.c
GENHDR = yyparse.h

all : ${DEPFILE} ${EXECNAME}

${EXECNAME} : ${OBJ}
	${C} -o bompiler ${OBJ}

%.o : %.c
	${C} -c $< ${HDR}

clean:
	rm -f ${OBJ} ${GENSRC} ${GENHDR} ${DEPFILE}

spotless: clean
	rm -f ${EXECNAME}

ci: 
	git add ${HDR} ${SRC} ${MKFILE} README.md DESIGN.md .gitignore

deps: ${SRC} ${GEN}
	${CDEP} ${SRC} ${GEN} ${MKFILE} >> ${DEPFILE}

format:
	indent -l80 -nfca -hnl -ncdb -bad -bap -nbc -bbo -nbfda -npsl -br -brs \
	-brf -ce -cdw -lps -saf -sai -saw -pcs -cs -bs -nut -ts4 -i4 -pi4 -ci4 \
	-cli4 -ppi4 -cbi0 -bli0 ${SRC} ${HDR}

${DEPFILE} :
	@ touch ${DEPFILE}
	${GMAKE} deps
